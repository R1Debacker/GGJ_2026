[gd_scene format=3 uid="uid://djtraiouswj0s"]

[ext_resource type="PackedScene" uid="uid://2480fobfbgyu" path="res://Assets/Character/SimplifiedCharacter.glb" id="1_k3upo"]

[sub_resource type="GDScript" id="GDScript_k3upo"]
resource_name = "top_view_3d_player"
script/source = "extends CharacterBody3D
class_name player3D_top_view

@export var speed = 5.0
@export var speed_rotation = 10.0
#@export var acceration = 4.0
#@export var jump_speed = 8.0

#var jumping = false
#var grounded = true
var last_direction := Vector3.ZERO

@onready var model := $Skeleton/Skeleton3D
@onready var anim_tree = $AnimationTree
@onready var anim_state = $AnimationTree.get(\"parameters/playback\")

#func _ready() -> void:
	

func _physics_process(delta: float):
	# Add the gravity.
	#if not is_on_floor():
		#velocity += get_gravity() * delta

	get_move_input(delta)
	
	move_and_slide()

func get_move_input(delta):
	
	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	
	var dir_z = Input.get_axis(\"top_view_move_down\",\"top_view_move_up\") * Vector3.FORWARD
	var dir_x = Input.get_axis(\"top_view_move_left\",\"top_view_move_right\") * Vector3.RIGHT
	
	var direction = (dir_z + dir_x).normalized()
	
	anim_tree.set(\"parameters/IDLE-WALK-RUN/blend_position\", direction.length())
	
	if direction != Vector3.ZERO:
		last_direction = direction
		
	velocity.x = direction.x * speed
	velocity.z = direction.z * speed
	
	#rotation = transform.looking_at(position + direction).basis.get_euler()
	
	rotation.y = rotate_toward(rotation.y,transform.looking_at(position + last_direction).basis.get_euler().y, delta * speed_rotation)
	
	#else:
		#velocity.x = move_toward(velocity.x, 0, speed)
		#velocity.z = move_toward(velocity.z, 0, speed)
"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_k3upo"]
animation = &"Attack_Kick"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_cp6nn"]
animation = &"Death_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_7fqn3"]
animation = &"Fall"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_7wd7x"]
animation = &"Run_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xrb60"]
animation = &"Idle_Look_Around"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_twaat"]
animation = &"Run_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_nd16m"]
animation = &"Walk_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0wcok"]
animation = &"Walk_Forward"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_tne0u"]
blend_point_0/node = SubResource("AnimationNodeAnimation_7wd7x")
blend_point_0/pos = 1.0
blend_point_1/node = SubResource("AnimationNodeAnimation_xrb60")
blend_point_1/pos = 0.0
blend_point_2/node = SubResource("AnimationNodeAnimation_twaat")
blend_point_2/pos = -1.0
blend_point_3/node = SubResource("AnimationNodeAnimation_nd16m")
blend_point_3/pos = 0.3
blend_point_4/node = SubResource("AnimationNodeAnimation_0wcok")
blend_point_4/pos = -0.3

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_b2lo3"]
animation = &"Jump"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_051so"]
animation = &"Jump_End"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6om21"]
animation = &"Jump_Start"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_y4py6"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xio6d"]
advance_mode = 2
advance_condition = &"jumping"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_e1imo"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_bn233"]
advance_mode = 2
advance_condition = &"grounded"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_j8rhf"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_x2rb6"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lv8mq"]
advance_mode = 2
advance_condition = &"grounded"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5h724"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5m2cu"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xpfbf"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_k3upo"]
states/Attack_Kick/node = SubResource("AnimationNodeAnimation_k3upo")
states/Attack_Kick/position = Vector2(219, -48)
states/Death_Forward/node = SubResource("AnimationNodeAnimation_cp6nn")
states/Death_Forward/position = Vector2(526, -32)
states/Fall/node = SubResource("AnimationNodeAnimation_7fqn3")
states/Fall/position = Vector2(351.5, 220.03125)
states/IDLE-WALK-RUN/node = SubResource("AnimationNodeBlendSpace1D_tne0u")
states/IDLE-WALK-RUN/position = Vector2(346.5, 111.375)
states/Jump/node = SubResource("AnimationNodeAnimation_b2lo3")
states/Jump/position = Vector2(357.5, 313.5)
states/Jump_End/node = SubResource("AnimationNodeAnimation_051so")
states/Jump_End/position = Vector2(512, 220.5625)
states/Jump_Start/node = SubResource("AnimationNodeAnimation_6om21")
states/Jump_Start/position = Vector2(187.5, 221.21875)
states/Start/position = Vector2(134.5, 113.75)
transitions = ["Start", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_y4py6"), "IDLE-WALK-RUN", "Jump_Start", SubResource("AnimationNodeStateMachineTransition_xio6d"), "Jump_Start", "Jump", SubResource("AnimationNodeStateMachineTransition_e1imo"), "Jump", "Jump_End", SubResource("AnimationNodeStateMachineTransition_bn233"), "Jump_End", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_j8rhf"), "IDLE-WALK-RUN", "Fall", SubResource("AnimationNodeStateMachineTransition_x2rb6"), "Fall", "Jump_End", SubResource("AnimationNodeStateMachineTransition_lv8mq"), "IDLE-WALK-RUN", "Death_Forward", SubResource("AnimationNodeStateMachineTransition_5h724"), "IDLE-WALK-RUN", "Attack_Kick", SubResource("AnimationNodeStateMachineTransition_5m2cu"), "Attack_Kick", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_xpfbf")]
graph_offset = Vector2(10, -32)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_bqdlq"]
radius = 0.201
height = 1.802

[node name="top view 3D Player" unique_id=863512122 instance=ExtResource("1_k3upo")]
script = SubResource("GDScript_k3upo")
speed = 7.0

[node name="Skeleton3D" parent="Skeleton" parent_id_path=PackedInt32Array(562029223) index="0" unique_id=874623409]
transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, 0, 0, 0)
bones/1/position = Vector3(0.01052178, 0.63479906, 0.03371571)
bones/1/rotation = Quaternion(-0.12958862, -0.017008532, 0.01683357, 0.9912791)
bones/1/scale = Vector3(1.0000001, 1.0000008, 1.0000007)
bones/2/position = Vector3(0.0979781, 0.014952768, -0.028237615)
bones/2/rotation = Quaternion(0.7565632, -0.053943757, 0.64924896, -0.056374535)
bones/2/scale = Vector3(0.999999, 0.99999946, 0.99999976)
bones/3/position = Vector3(6.911169e-08, 0.33968914, 2.3784396e-07)
bones/3/rotation = Quaternion(-0.009293152, 0.046205148, 0.64720047, 0.76086164)
bones/3/scale = Vector3(0.99999946, 0.99999946, 1.0000001)
bones/4/position = Vector3(-2.2348114e-08, 0.3595294, -2.579783e-06)
bones/4/rotation = Quaternion(0.38726386, 0.5347283, -0.34812498, 0.66550833)
bones/4/scale = Vector3(1.0000006, 0.9999993, 1.0000001)
bones/5/position = Vector3(-7.634276e-08, 0.13862453, 1.3676963e-07)
bones/5/rotation = Quaternion(-1.8112142e-06, 0.9996012, -0.028241388, -3.5381129e-06)
bones/5/scale = Vector3(1.0000002, 1.0000001, 1.0000001)
bones/6/position = Vector3(-3.2211818e-07, 0.10254786, 0.056476805)
bones/6/rotation = Quaternion(0.26535308, -0.03088394, -0.007371566, 0.9636284)
bones/7/position = Vector3(2.5201717e-07, 0.21461913, -5.158321e-08)
bones/7/rotation = Quaternion(0.042485364, -0.027470846, 0.037764013, 0.99800515)
bones/7/scale = Vector3(1.0000004, 1.0000005, 1.0000001)
bones/8/position = Vector3(4.811986e-07, 0.29898974, -0.0016212851)
bones/8/rotation = Quaternion(0.06655097, 0.011955416, 0.0070195463, 0.99768674)
bones/8/scale = Vector3(0.9999997, 0.999999, 1)
bones/9/position = Vector3(-8.350854e-07, 0.09232363, 2.343239e-07)
bones/9/rotation = Quaternion(-0.067273736, 0.046452224, -0.055194724, 0.99512315)
bones/9/scale = Vector3(1.0000001, 1.0000004, 1.0000006)
bones/10/position = Vector3(0.03218409, 0.24856421, 0.0008099828)
bones/10/rotation = Quaternion(0.49682835, 0.4390797, 0.65347487, -0.3651593)
bones/10/scale = Vector3(0.9999997, 0.9999984, 0.9999996)
bones/11/position = Vector3(3.3611957e-07, 0.12703116, -1.3882883e-06)
bones/11/rotation = Quaternion(-0.3558538, 0.10459482, -0.0297739, 0.9281926)
bones/11/scale = Vector3(1.0000001, 1.0000004, 1.0000004)
bones/12/position = Vector3(-2.924212e-07, 0.29205737, 1.9291074e-06)
bones/12/rotation = Quaternion(0.47310063, 0.5581219, -0.4680007, 0.49563202)
bones/12/scale = Vector3(1.000001, 1.0000008, 0.99999946)
bones/13/position = Vector3(6.8005335e-07, 0.23034094, 1.8696122e-07)
bones/13/rotation = Quaternion(0.07097825, -0.08813356, -0.15193014, 0.98189193)
bones/13/scale = Vector3(0.9999997, 1.0000001, 0.99999964)
bones/14/position = Vector3(-0.011883847, 0.105741665, 0.0388825)
bones/14/rotation = Quaternion(0.06630004, 0.78213257, -0.07260307, 0.61530626)
bones/14/scale = Vector3(0.9999999, 0.99999964, 1.0000005)
bones/15/position = Vector3(-6.4963837e-07, 0.03901576, -7.978619e-07)
bones/15/rotation = Quaternion(-1.3397128e-08, -0.008824149, 5.2425122e-08, 0.9999611)
bones/15/scale = Vector3(0.99999994, 0.99999964, 0.99999976)
bones/16/position = Vector3(-0.013651104, 0.1066709, 0.0053759324)
bones/16/rotation = Quaternion(0.015756989, 0.7607149, -0.049482204, 0.6470055)
bones/16/scale = Vector3(0.9999998, 0.9999989, 1.0000006)
bones/17/position = Vector3(-5.31491e-07, 0.041120812, 1.922548e-07)
bones/17/rotation = Quaternion(-1.7940199e-08, 0.06740804, 1.8612454e-09, 0.9977255)
bones/17/scale = Vector3(0.99999994, 1.0000002, 0.9999995)
bones/18/position = Vector3(-0.011944835, 0.088858485, -0.05634232)
bones/18/rotation = Quaternion(-0.027553968, 0.7103214, -0.12914242, 0.69138014)
bones/18/scale = Vector3(1, 0.9999996, 1.0000002)
bones/19/position = Vector3(-2.1849563e-07, 0.035424106, 5.0858085e-07)
bones/19/rotation = Quaternion(1.0030731e-08, 0.014233054, -5.9374123e-09, 0.99989873)
bones/19/scale = Vector3(0.9999999, 0.9999996, 0.9999996)
bones/20/position = Vector3(0.03158391, 0.09564291, -0.006133832)
bones/20/rotation = Quaternion(0.08764797, 0.6836664, -0.13569674, 0.71169126)
bones/20/scale = Vector3(0.99999994, 0.9999995, 0.9999997)
bones/21/position = Vector3(-0.015765212, 0.094920024, -0.026632644)
bones/21/rotation = Quaternion(0.016826892, 0.74243546, -0.1057057, 0.66131145)
bones/21/scale = Vector3(0.99999976, 0.99999994, 1.0000002)
bones/22/position = Vector3(8.754375e-08, 0.047298428, 2.4765825e-09)
bones/22/rotation = Quaternion(-1.0072406e-08, 0.017694868, -6.4162435e-09, 0.9998434)
bones/22/scale = Vector3(1.0000002, 0.9999998, 0.99999964)
bones/23/position = Vector3(0.02166115, 0.043445725, 0.044851754)
bones/23/rotation = Quaternion(0.18863565, 0.9549242, 0.19843514, 0.114716776)
bones/23/scale = Vector3(0.9999997, 1.0000012, 0.9999998)
bones/24/position = Vector3(6.136088e-07, 0.052411392, 8.894441e-08)
bones/24/rotation = Quaternion(2.6765784e-08, -0.05642812, 1.1035611e-08, 0.9984067)
bones/24/scale = Vector3(1.0000007, 0.9999985, 0.9999998)
bones/25/position = Vector3(-0.03218387, 0.2485637, 0.0008107514)
bones/25/rotation = Quaternion(-0.5252556, 0.43815744, 0.5914659, 0.42695758)
bones/25/scale = Vector3(1.0000001, 0.9999993, 0.9999999)
bones/26/position = Vector3(1.1632114e-07, 0.12703116, -5.8692643e-07)
bones/26/rotation = Quaternion(-0.38811716, -0.21088006, -0.025680847, 0.8967917)
bones/26/scale = Vector3(0.9999997, 1.0000005, 0.99999905)
bones/27/position = Vector3(3.5000477e-07, 0.2920576, 1.1603424e-06)
bones/27/rotation = Quaternion(0.40229538, -0.5998323, 0.4110104, 0.5562644)
bones/27/scale = Vector3(1.0000006, 1.0000005, 1.0000002)
bones/28/position = Vector3(-5.0188214e-07, 0.23034132, 4.750482e-07)
bones/28/rotation = Quaternion(0.025796877, 0.1471462, 0.07488854, 0.9859383)
bones/28/scale = Vector3(0.99999994, 1.0000002, 0.99999887)
bones/29/position = Vector3(0.011883845, 0.105741374, 0.038882338)
bones/29/rotation = Quaternion(0.06630006, -0.78213257, 0.072603054, 0.61530626)
bones/29/scale = Vector3(1.0000004, 0.9999996, 1.0000001)
bones/30/position = Vector3(-1.3685658e-07, 0.039015844, -7.592637e-07)
bones/30/rotation = Quaternion(-1.22676465e-08, 0.008824146, -6.346523e-08, 0.9999611)
bones/30/scale = Vector3(0.99999976, 1.0000006, 1.0000002)
bones/31/position = Vector3(0.013651293, 0.10667014, 0.005375679)
bones/31/rotation = Quaternion(0.01575697, -0.7607149, 0.049482208, 0.6470055)
bones/31/scale = Vector3(1.0000002, 0.99999946, 1.0000005)
bones/32/position = Vector3(-4.9893778e-08, 0.041121025, 3.611248e-07)
bones/32/rotation = Quaternion(-2.1555453e-08, -0.06740802, -8.355428e-09, 0.9977255)
bones/32/scale = Vector3(0.9999998, 0.9999996, 0.9999992)
bones/33/position = Vector3(0.01194475, 0.08885806, -0.0563428)
bones/33/rotation = Quaternion(-0.027553963, -0.7103214, 0.1291424, 0.69138014)
bones/33/scale = Vector3(0.9999996, 0.9999996, 1.0000004)
bones/34/position = Vector3(-1.5976822e-07, 0.03542436, 5.72801e-07)
bones/34/rotation = Quaternion(1.3897942e-08, -0.014233054, 1.928416e-08, 0.99989873)
bones/34/scale = Vector3(1.0000006, 0.99999994, 0.9999992)
bones/35/position = Vector3(-0.03158407, 0.09564248, -0.006134401)
bones/35/rotation = Quaternion(0.08764795, -0.6836664, 0.13569675, 0.71169126)
bones/35/scale = Vector3(1.0000004, 1.0000004, 1)
bones/36/position = Vector3(0.015764765, 0.0949199, -0.02663315)
bones/36/rotation = Quaternion(0.016826874, -0.74243546, 0.1057057, 0.66131145)
bones/36/scale = Vector3(1.0000002, 1, 1.0000001)
bones/37/position = Vector3(-1.727671e-07, 0.047298986, -4.6999264e-07)
bones/37/rotation = Quaternion(-1.6241396e-08, -0.017694851, 1.7327519e-09, 0.9998434)
bones/37/scale = Vector3(1.0000004, 1.0000002, 1.0000001)
bones/38/position = Vector3(-0.021661326, 0.04344504, 0.04485121)
bones/38/rotation = Quaternion(-0.18863565, 0.9549242, 0.19843517, -0.114716806)
bones/38/scale = Vector3(1, 1.0000018, 0.9999999)
bones/39/position = Vector3(-4.4023415e-07, 0.05241215, 2.4065423e-07)
bones/39/rotation = Quaternion(3.881546e-08, 0.05642812, -1.3555919e-08, 0.9984067)
bones/39/scale = Vector3(1.0000005, 0.99999845, 0.99999976)
bones/40/rotation = Quaternion(-0.70233595, 0.19026138, 0.6476471, -0.2260048)
bones/40/scale = Vector3(0.9999984, 0.9999997, 0.99999887)
bones/41/position = Vector3(8.4029466e-08, 0.3396888, 2.697492e-07)
bones/41/rotation = Quaternion(0.015051625, 0.036092427, -0.5732046, 0.81847876)
bones/41/scale = Vector3(0.99999905, 1.0000004, 0.9999997)
bones/42/position = Vector3(-1.1919994e-09, 0.359529, -3.5301454e-07)
bones/42/rotation = Quaternion(0.48570493, -0.55337954, 0.44618142, 0.50870806)
bones/42/scale = Vector3(1.0000007, 0.99999976, 0.9999995)
bones/43/position = Vector3(1.0194256e-07, 0.13862488, -1.137431e-07)
bones/43/rotation = Quaternion(-2.3600205e-07, 0.99989647, 0.014391172, 5.869382e-06)
bones/43/scale = Vector3(0.9999998, 1.0000002, 0.9999999)

[node name="AnimationPlayer" parent="." index="1" unique_id=1545922745]
speed_scale = 1.5

[node name="AnimationTree" type="AnimationTree" parent="." index="2" unique_id=447910337]
root_motion_track = NodePath("Skeleton/Skeleton3D:Root")
tree_root = SubResource("AnimationNodeStateMachine_k3upo")
anim_player = NodePath("../AnimationPlayer")
parameters/conditions/grounded = false
parameters/conditions/jumping = false
parameters/IDLE-WALK-RUN/blend_position = 0.82950425

[node name="CollisionShape3D" type="CollisionShape3D" parent="." index="3" unique_id=575934891]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9202517, 0)
shape = SubResource("CapsuleShape3D_bqdlq")

[node name="Camera3D" type="Camera3D" parent="." index="4" unique_id=298455434]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, 1, 0, -1, -4.371139e-08, 0, 8, 0)
