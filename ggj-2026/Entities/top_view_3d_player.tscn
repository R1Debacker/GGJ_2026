[gd_scene format=3 uid="uid://djtraiouswj0s"]

[ext_resource type="PackedScene" uid="uid://2480fobfbgyu" path="res://Assets/Character/SimplifiedCharacter.glb" id="1_k3upo"]

[sub_resource type="GDScript" id="GDScript_k3upo"]
resource_name = "top_view_3d_player"
script/source = "extends CharacterBody3D
class_name player3D_top_view

@export var speed = 7.0
@export var speed_rotation = 10.0
#@export var acceration = 4.0
#@export var jump_speed = 8.0

#var jumping = false
#var grounded = true
var last_direction := Vector3.ZERO

@onready var model := $Skeleton/Skeleton3D
@onready var anim_tree = $AnimationTree
@onready var anim_state = $AnimationTree.get(\"parameters/playback\")


func _ready() -> void:
	anim_tree.active = true
	

func _physics_process(delta: float):
	# Add the gravity.
	#if not is_on_floor():
		#velocity += get_gravity() * delta

	get_move_input(delta)
	
	move_and_slide()

func get_move_input(delta):
	
	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	
	var dir_z = Input.get_axis(\"top_view_move_down\",\"top_view_move_up\") * Vector3.FORWARD
	var dir_x = Input.get_axis(\"top_view_move_left\",\"top_view_move_right\") * Vector3.RIGHT
	
	var direction = (dir_z + dir_x)
	var magnitude = direction.length()
	direction = direction.normalized()
	
	anim_tree.set(\"parameters/IDLE-WALK-RUN/blend_position\", magnitude)
	
	if direction != Vector3.ZERO:
		last_direction = direction
		
	velocity.x = direction.x * speed * magnitude
	velocity.z = direction.z * speed * magnitude
	
	#rotation = transform.looking_at(position + direction).basis.get_euler()
	
	rotation.y = rotate_toward(rotation.y,transform.looking_at(position + last_direction).basis.get_euler().y, delta * speed_rotation)
	
	#else:
		#velocity.x = move_toward(velocity.x, 0, speed)
		#velocity.z = move_toward(velocity.z, 0, speed)
"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_k3upo"]
animation = &"Attack_Kick"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_cp6nn"]
animation = &"Death_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_7fqn3"]
animation = &"Fall"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_7wd7x"]
animation = &"Run_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xrb60"]
animation = &"Idle_Look_Around"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_twaat"]
animation = &"Run_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_nd16m"]
animation = &"Walk_Forward"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0wcok"]
animation = &"Walk_Forward"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_tne0u"]
blend_point_0/node = SubResource("AnimationNodeAnimation_7wd7x")
blend_point_0/pos = 1.0
blend_point_1/node = SubResource("AnimationNodeAnimation_xrb60")
blend_point_1/pos = 0.0
blend_point_2/node = SubResource("AnimationNodeAnimation_twaat")
blend_point_2/pos = -1.0
blend_point_3/node = SubResource("AnimationNodeAnimation_nd16m")
blend_point_3/pos = 0.3
blend_point_4/node = SubResource("AnimationNodeAnimation_0wcok")
blend_point_4/pos = -0.3

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_b2lo3"]
animation = &"Jump"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_051so"]
animation = &"Jump_End"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6om21"]
animation = &"Jump_Start"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_y4py6"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xio6d"]
advance_mode = 2
advance_condition = &"jumping"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_e1imo"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_bn233"]
advance_mode = 2
advance_condition = &"grounded"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_j8rhf"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_x2rb6"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lv8mq"]
advance_mode = 2
advance_condition = &"grounded"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5h724"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5m2cu"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xpfbf"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_k3upo"]
states/Attack_Kick/node = SubResource("AnimationNodeAnimation_k3upo")
states/Attack_Kick/position = Vector2(219, -48)
states/Death_Forward/node = SubResource("AnimationNodeAnimation_cp6nn")
states/Death_Forward/position = Vector2(526, -32)
states/Fall/node = SubResource("AnimationNodeAnimation_7fqn3")
states/Fall/position = Vector2(351.5, 220.03125)
states/IDLE-WALK-RUN/node = SubResource("AnimationNodeBlendSpace1D_tne0u")
states/IDLE-WALK-RUN/position = Vector2(346.5, 111.375)
states/Jump/node = SubResource("AnimationNodeAnimation_b2lo3")
states/Jump/position = Vector2(357.5, 313.5)
states/Jump_End/node = SubResource("AnimationNodeAnimation_051so")
states/Jump_End/position = Vector2(512, 220.5625)
states/Jump_Start/node = SubResource("AnimationNodeAnimation_6om21")
states/Jump_Start/position = Vector2(187.5, 221.21875)
states/Start/position = Vector2(134.5, 113.75)
transitions = ["Start", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_y4py6"), "IDLE-WALK-RUN", "Jump_Start", SubResource("AnimationNodeStateMachineTransition_xio6d"), "Jump_Start", "Jump", SubResource("AnimationNodeStateMachineTransition_e1imo"), "Jump", "Jump_End", SubResource("AnimationNodeStateMachineTransition_bn233"), "Jump_End", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_j8rhf"), "IDLE-WALK-RUN", "Fall", SubResource("AnimationNodeStateMachineTransition_x2rb6"), "Fall", "Jump_End", SubResource("AnimationNodeStateMachineTransition_lv8mq"), "IDLE-WALK-RUN", "Death_Forward", SubResource("AnimationNodeStateMachineTransition_5h724"), "IDLE-WALK-RUN", "Attack_Kick", SubResource("AnimationNodeStateMachineTransition_5m2cu"), "Attack_Kick", "IDLE-WALK-RUN", SubResource("AnimationNodeStateMachineTransition_xpfbf")]
graph_offset = Vector2(10, -32)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_bqdlq"]
radius = 0.201
height = 1.802

[node name="top view 3D Player" unique_id=863512122 instance=ExtResource("1_k3upo")]
transform = Transform3D(1.9, 0, 0, 0, 1.9, 0, 0, 0, 1.9, 0, 0, 0)
script = SubResource("GDScript_k3upo")

[node name="Skeleton3D" parent="Skeleton" parent_id_path=PackedInt32Array(562029223) index="0" unique_id=874623409]
transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, 0, 0, 0)
bones/1/position = Vector3(-3.0765375e-14, 0.79327625, -0.00031300314)
bones/1/rotation = Quaternion(-0.24775839, 9.708203e-07, -2.4826946e-07, 0.9688219)
bones/1/scale = Vector3(1.0000012, 1.0000014, 1.0000001)
bones/2/position = Vector3(0.097978055, 0.014953104, -0.028238071)
bones/2/scale = Vector3(0.9999985, 0.99999493, 1.0000043)
bones/3/position = Vector3(-5.301744e-09, 0.33968967, 4.430227e-09)
bones/3/rotation = Quaternion(0.006562098, -0.006816666, 0.10785358, 0.9941218)
bones/3/scale = Vector3(0.99999803, 1, 1.0000001)
bones/4/position = Vector3(-1.44908405e-08, 0.35952845, -1.0992382e-08)
bones/4/scale = Vector3(0.9999982, 1.0000023, 1.0000013)
bones/5/position = Vector3(-1.0747218e-09, 0.13862467, -1.4482748e-09)
bones/5/rotation = Quaternion(1.5367057e-08, 1, -5.2154153e-08, -5.439916e-06)
bones/5/scale = Vector3(1.0000006, 0.9999982, 1.0000005)
bones/6/position = Vector3(-1.13186054e-07, 0.102548115, 0.05647655)
bones/6/rotation = Quaternion(0.23109375, -9.749384e-07, 2.3157043e-07, 0.9729315)
bones/7/position = Vector3(2.5437426e-20, 0.21461838, 8.61193e-10)
bones/7/rotation = Quaternion(-0.0056683253, -4.2765227e-13, 5.926481e-14, 0.999984)
bones/7/scale = Vector3(1, 0.9999997, 0.9999996)
bones/8/position = Vector3(-1.385584e-15, 0.2989908, -0.0016210747)
bones/8/rotation = Quaternion(0.11318146, 2.7609135e-14, -9.358809e-14, 0.9935744)
bones/8/scale = Vector3(1.0000005, 0.9999996, 0.99999994)
bones/9/position = Vector3(9.190319e-20, 0.09232276, 6.053756e-09)
bones/9/rotation = Quaternion(2.4214387e-07, 1.9746453e-19, -1.2853609e-19, 1)
bones/9/scale = Vector3(0.9999993, 1.0000007, 1.0000005)
bones/10/position = Vector3(0.03218399, 0.2485641, 0.0008105319)
bones/10/rotation = Quaternion(0.52331066, 0.45552132, 0.5451747, -0.47056448)
bones/10/scale = Vector3(1.0000006, 0.99999845, 1.0000004)
bones/11/position = Vector3(-1.3017371e-08, 0.12703101, 2.3935425e-07)
bones/11/rotation = Quaternion(-0.18721202, 0.0034700055, 0.06889398, 0.9798945)
bones/11/scale = Vector3(0.99999887, 1.0000007, 1.0000005)
bones/12/position = Vector3(-4.8110405e-09, 0.292057, -1.9615783e-08)
bones/12/rotation = Quaternion(0.08783073, 0.7063121, -0.12390293, 0.6914167)
bones/12/scale = Vector3(1, 1.0000012, 1.0000006)
bones/13/position = Vector3(-7.4861916e-08, 0.23034137, -5.5562115e-09)
bones/13/rotation = Quaternion(-0.06332684, -0.057902046, -0.18569624, 0.9788534)
bones/13/scale = Vector3(0.99999946, 0.9999998, 0.9999988)
bones/14/position = Vector3(-0.011883889, 0.10574158, 0.03888241)
bones/14/rotation = Quaternion(0.06630005, 0.78213257, -0.072603054, 0.61530626)
bones/14/scale = Vector3(1.0000002, 1.0000008, 1.0000004)
bones/15/position = Vector3(9.612451e-09, 0.039015166, 1.7182785e-08)
bones/15/rotation = Quaternion(-4.274061e-08, -0.008824146, 4.8676355e-08, 0.9999611)
bones/15/scale = Vector3(0.99999976, 0.9999991, 1.0000002)
bones/16/position = Vector3(-0.013650958, 0.10667065, 0.0053756814)
bones/16/rotation = Quaternion(0.015756972, 0.7607149, -0.049482193, 0.6470055)
bones/16/scale = Vector3(1, 0.999999, 1)
bones/17/position = Vector3(-3.1461376e-09, 0.0411214, -9.882925e-08)
bones/17/rotation = Quaternion(-2.7354887e-09, 0.067408025, 7.3842925e-11, 0.9977255)
bones/17/scale = Vector3(0.9999994, 1.0000015, 0.9999995)
bones/18/position = Vector3(-0.011944723, 0.08885841, -0.056342468)
bones/18/rotation = Quaternion(-0.02755395, 0.7103214, -0.12914243, 0.69138014)
bones/18/scale = Vector3(0.9999997, 0.99999994, 1.0000005)
bones/19/position = Vector3(-6.0418532e-09, 0.03542477, -2.029204e-07)
bones/19/rotation = Quaternion(2.6656014e-08, 0.01423305, -2.6283434e-08, 0.99989873)
bones/19/scale = Vector3(1.0000004, 1, 0.99999946)
bones/20/position = Vector3(0.031583905, 0.09564276, -0.006133874)
bones/20/rotation = Quaternion(0.08764795, 0.6836664, -0.13569674, 0.71169126)
bones/20/scale = Vector3(1.0000006, 1.0000007, 1.0000004)
bones/21/position = Vector3(-0.015765095, 0.094919994, -0.026633034)
bones/21/rotation = Quaternion(0.016826874, 0.74243546, -0.105705686, 0.66131145)
bones/21/scale = Vector3(1.0000005, 1.0000006, 0.99999994)
bones/22/position = Vector3(6.1270544e-10, 0.047298837, -6.421137e-08)
bones/22/rotation = Quaternion(-6.6945105e-10, 0.017694851, -9.675855e-09, 0.99984354)
bones/22/scale = Vector3(0.99999994, 0.9999989, 0.99999976)
bones/23/position = Vector3(0.02166069, 0.043445896, 0.04485132)
bones/23/rotation = Quaternion(0.18863566, 0.9549242, 0.19843513, 0.1147168)
bones/23/scale = Vector3(1.0000007, 1.0000013, 0.99999994)
bones/24/position = Vector3(-3.434971e-08, 0.052411985, 1.3935647e-07)
bones/24/rotation = Quaternion(2.6365933e-08, -0.056428112, 2.6264434e-08, 0.9984067)
bones/24/scale = Vector3(0.9999994, 0.9999987, 0.9999999)
bones/25/position = Vector3(-0.03218399, 0.2485641, 0.0008105319)
bones/25/rotation = Quaternion(-0.5233106, 0.45552135, 0.54517466, 0.47056445)
bones/25/scale = Vector3(1.0000006, 0.99999845, 1.0000004)
bones/26/position = Vector3(1.3017371e-08, 0.12703101, 2.3935425e-07)
bones/26/rotation = Quaternion(-0.18721202, -0.003470005, -0.06889397, 0.9798945)
bones/26/scale = Vector3(0.9999988, 1.0000007, 1.0000005)
bones/27/position = Vector3(1.079641e-09, 0.29205695, -1.6913056e-08)
bones/27/rotation = Quaternion(0.08783073, -0.7063121, 0.12390293, 0.6914167)
bones/27/scale = Vector3(0.99999994, 0.9999995, 1.0000007)
bones/28/position = Vector3(-6.162426e-08, 0.2303414, 1.113796e-08)
bones/28/rotation = Quaternion(-0.06332684, 0.057902038, 0.1856962, 0.9788535)
bones/28/scale = Vector3(1, 1.0000004, 0.9999997)
bones/29/position = Vector3(0.011883769, 0.10574187, 0.03888236)
bones/29/rotation = Quaternion(0.06630005, -0.78213257, 0.07260306, 0.61530626)
bones/29/scale = Vector3(0.99999976, 1.0000006, 1.0000005)
bones/30/position = Vector3(-2.7598313e-09, 0.039015263, 8.8784844e-08)
bones/30/rotation = Quaternion(-2.2256398e-08, 0.008824146, -4.9322797e-08, 0.9999611)
bones/30/scale = Vector3(1.0000006, 0.99999905, 0.9999998)
bones/31/position = Vector3(0.013650924, 0.10667094, 0.005375664)
bones/31/rotation = Quaternion(0.015756974, -0.7607149, 0.049482193, 0.6470055)
bones/31/scale = Vector3(0.9999998, 0.9999992, 1.0000001)
bones/32/position = Vector3(1.4997786e-08, 0.041121367, -1.9457713e-07)
bones/32/rotation = Quaternion(6.947434e-09, -0.067408025, 8.1371276e-10, 0.9977255)
bones/32/scale = Vector3(1.0000004, 0.99999994, 0.9999988)
bones/33/position = Vector3(0.011944579, 0.088858545, -0.056342464)
bones/33/rotation = Quaternion(-0.027553963, -0.7103214, 0.1291424, 0.69138014)
bones/33/scale = Vector3(0.9999993, 0.99999934, 1.0000006)
bones/34/position = Vector3(4.066969e-09, 0.035424974, -1.3356498e-07)
bones/34/rotation = Quaternion(1.3497234e-08, -0.014233044, 2.2370457e-08, 0.99989873)
bones/34/scale = Vector3(1.0000011, 1.0000002, 0.9999995)
bones/35/position = Vector3(-0.03158381, 0.09564296, -0.0061338977)
bones/35/rotation = Quaternion(0.08764794, -0.68366647, 0.13569675, 0.7116913)
bones/35/scale = Vector3(1.0000004, 1.0000006, 0.99999994)
bones/36/position = Vector3(0.015764944, 0.09492029, -0.026633082)
bones/36/rotation = Quaternion(0.016826876, -0.74243546, 0.105705686, 0.66131145)
bones/36/scale = Vector3(1.0000007, 1.0000006, 0.9999998)
bones/37/position = Vector3(5.8684497e-09, 0.047298864, 6.8581755e-08)
bones/37/rotation = Quaternion(-3.0798788e-08, -0.01769485, 1.4731454e-08, 0.99984354)
bones/37/scale = Vector3(0.99999946, 0.999999, 1.0000001)
bones/38/position = Vector3(-0.02166072, 0.043445956, 0.044851255)
bones/38/rotation = Quaternion(-0.18863565, 0.9549241, 0.19843516, -0.11471679)
bones/38/scale = Vector3(1.0000008, 1.0000017, 0.9999991)
bones/39/position = Vector3(-9.482193e-10, 0.052411843, -6.60744e-09)
bones/39/rotation = Quaternion(3.566432e-08, 0.056428105, -2.6789968e-08, 0.9984067)
bones/39/scale = Vector3(1.0000001, 0.99999774, 1.0000011)
bones/40/rotation = Quaternion(-0.69055384, -0.14536484, 0.6942834, 0.14133346)
bones/40/scale = Vector3(0.99999875, 0.9999939, 1.0000027)
bones/41/position = Vector3(-1.5704384e-09, 0.3396897, 5.045021e-09)
bones/41/rotation = Quaternion(0.0065620905, 0.0068165935, -0.107853554, 0.9941218)
bones/41/scale = Vector3(0.99999964, 1.0000004, 0.9999998)
bones/42/position = Vector3(2.263179e-08, 0.35952863, -7.012127e-09)
bones/42/rotation = Quaternion(0.37091267, -0.60024923, 0.37896156, 0.5987595)
bones/42/scale = Vector3(1.0000014, 0.9999998, 0.99999857)
bones/43/position = Vector3(-1.2397599e-09, 0.13862465, -4.2571724e-09)
bones/43/rotation = Quaternion(-4.6564255e-09, 1, -7.4503212e-09, 6.1551723e-06)
bones/43/scale = Vector3(1.000001, 0.99999976, 1.0000001)

[node name="AnimationPlayer" parent="." index="1" unique_id=1545922745]
speed_scale = 1.5

[node name="AnimationTree" type="AnimationTree" parent="." index="2" unique_id=447910337]
active = false
root_motion_track = NodePath("Skeleton/Skeleton3D:Root")
tree_root = SubResource("AnimationNodeStateMachine_k3upo")
anim_player = NodePath("../AnimationPlayer")
parameters/conditions/grounded = false
parameters/conditions/jumping = false
parameters/IDLE-WALK-RUN/blend_position = 0.0036275387

[node name="CollisionShape3D" type="CollisionShape3D" parent="." index="3" unique_id=575934891]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9202517, 0)
shape = SubResource("CapsuleShape3D_bqdlq")
